{% extends 'posts/base.html' %}
{% load static %}

{% block title %} - @{{ search_user_main.username }}{% endblock title %}

{% block link %}
<style>
  .user-profile-container {
    max-width: 975px;
    margin: 2rem auto;
    padding: 0 1rem;
  }

  .profile-header {
    background: var(--color-white);
    padding: 2rem;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-md);
    margin-bottom: 2rem;
    display: flex;
    gap: 3rem;
    align-items: start;
  }

  .profile-avatar-large {
    width: 150px;
    height: 150px;
    border-radius: var(--radius-full);
    object-fit: cover;
    border: 3px solid var(--color-gray-200);
    flex-shrink: 0;
  }

  .profile-info {
    flex: 1;
  }

  .profile-username {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .profile-username h2 {
    margin: 0;
    font-size: 1.75rem;
    color: var(--color-gray-900);
  }

  .follow-btn-large {
    padding: 0.5rem 2rem;
    background: var(--color-primary);
    color: var(--color-white);
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-base);
  }

  .follow-btn-large:hover {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
  }

  .follow-btn-large.following {
    background: var(--color-white);
    color: var(--color-gray-900);
    border: 2px solid var(--color-gray-300);
  }

  .profile-stats {
    display: flex;
    gap: 2rem;
    margin-bottom: 1.5rem;
  }

  .stat-item {
    font-size: 1rem;
  }

  .stat-item b {
    font-weight: 700;
    color: var(--color-gray-900);
  }

  .profile-bio h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
    font-weight: 700;
    color: var(--color-gray-900);
  }

  .profile-bio p {
    margin: 0;
    color: var(--color-gray-600);
    line-height: 1.6;
  }

  .profile-tabs {
    background: var(--color-white);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
  }

  .tab-buttons {
    display: flex;
    border-bottom: 1px solid var(--color-gray-200);
  }

  .tab-btn {
    flex: 1;
    padding: 1rem;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    font-weight: 600;
    color: var(--color-gray-500);
    transition: all var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .tab-btn.active {
    color: var(--color-gray-900);
    border-bottom-color: var(--color-gray-900);
  }

  .tab-btn:hover {
    background: var(--color-gray-50);
  }

  .posts-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    padding: 1rem;
  }

  .grid-post {
    aspect-ratio: 1;
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-base);
  }

  .grid-post:hover {
    transform: scale(1.02);
  }

  .grid-post img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .empty-posts {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--color-gray-500);
  }

  @media (max-width: 768px) {
    .profile-header {
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1.5rem;
    }

    .profile-avatar-large {
      width: 100px;
      height: 100px;
    }

    .profile-username {
      flex-direction: column;
      gap: 1rem;
    }

    .profile-stats {
      justify-content: center;
    }

    .posts-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 0.25rem;
    }
  }
</style>
{% endblock link %}

{% block user_container %}
<div class="user-profile-container">
  <div class="profile-header">
    <img src="{{ other_user_profile.profile_pics.url }}" alt="{{ search_user_main.username }}"
      class="profile-avatar-large">

    <div class="profile-info">
      <div class="profile-username">
        <h2>@{{ search_user_main.username }}</h2>
        <form action="/follow" method="post" style="margin: 0;">
          {% csrf_token %}
          <input type="hidden" value="{{ search_user_main.username }}" name="following" />
          <button type="submit" class="follow-btn-large {% if is_following %}following{% endif %}">
            {% if is_following %}Following{% else %}Follow{% endif %}
          </button>
        </form>
      </div>

      <div class="profile-stats">
        <span class="stat-item"><b>{{ posts|length }}</b> posts</span>
        <span class="stat-item"><b>{{ num_follower }}</b> followers</span>
        <span class="stat-item"><b>{{ num_following }}</b> following</span>
      </div>

      <div class="profile-bio">
        <h4>{{ search_user_main.first_name }} {{ search_user_main.last_name }}</h4>
        {% if other_user_profile.bio %}
        <p>{{ other_user_profile.bio }}</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="profile-tabs">
    <div class="tab-buttons">
      <button class="tab-btn active">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
          <rect x="3" y="3" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"></rect>
          <line x1="9" y1="3" x2="9" y2="21" stroke="currentColor" stroke-width="2"></line>
          <line x1="15" y1="3" x2="15" y2="21" stroke="currentColor" stroke-width="2"></line>
          <line x1="3" y1="9" x2="21" y2="9" stroke="currentColor" stroke-width="2"></line>
          <line x1="3" y1="15" x2="21" y2="15" stroke="currentColor" stroke-width="2"></line>
        </svg>
        Posts
      </button>
    </div>

    <div class="posts-grid">
      {% if posts %}
      {% for post in posts reversed %}
      <a href="/post/{{ post.id }}" class="grid-post">
        <img src="{{ post.post_img.url }}" alt="{{ post.caption }}">
      </a>
      {% endfor %}
      {% else %}
      <div class="empty-posts" style="grid-column: 1 / -1;">
        <h3>No Posts Yet</h3>
        <p>When @{{ search_user_main.username }} shares photos, they'll appear here.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock user_container %}